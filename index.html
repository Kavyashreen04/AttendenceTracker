<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Attendance Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    input, button, select {
      margin: 5px;
      padding: 6px;
      font-size: 1em;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .present {
      color: green;
      font-weight: bold;
    }
    .absent {
      color: red;
      font-weight: bold;
    }
    .form-section {
      background-color: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .day-detail span {
      display: inline-block;
      margin: 2px 4px;
      padding: 3px 6px;
      border-radius: 3px;
    }
    .day-detail .present-day {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .day-detail .absent-day {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
  </style>
</head>
<body>
  <h2>Student Attendance Tracker</h2>

  <div class="form-section">
    <label>Student Name: <input type="text" id="studentName" /></label>
    <label>Joining Date: <input type="date" id="joiningDate" /></label>
    <button onclick="addStudent()">Add Student</button>
  </div>

  <div class="form-section">
    <label>Select Date: <input type="date" id="attendanceDate" /></label>
    <button onclick="renderAttendanceForm()">Mark Attendance</button>
    <div id="attendanceForm"></div>
  </div>

  <div class="form-section">
    <h3>Attendance Report</h3>
    <label>Month: <input type="month" id="reportMonth" onchange="updateReport()" /></label>
    <table id="reportTable">
      <thead>
        <tr><th>Name</th><th>Join Date</th><th>Present</th><th>Absent</th><th>Percentage</th><th>Days Detail</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const students = [];
    const allDates = new Set();

    function formatDate(date) {
      return new Date(date).toISOString().split('T')[0];
    }

    function addStudent() {
      const name = document.getElementById('studentName').value;
      const joinDate = document.getElementById('joiningDate').value;
      if (!name || !joinDate) return alert("Please enter name and join date.");

      const student = {
        name,
        joinDate,
        attendance: {}
      };

      allDates.forEach(date => {
        if (date < joinDate) {
          student.attendance[date] = "Absent";
        }
      });

<<<<<<< HEAD
      students.push(student);
      updateReport();
      alert("Student added successfully.");
=======

<<<<<<< HEAD
<<<<<<< HEAD

      studentsList.innerHTML = '';
      let headerRow = document.createElement('div');
=======
    
      const headerRow = document.createElement('div');
>>>>>>> ecb880488960850796065d4696bbb7b4e0cc5b85
=======
    
      const headerRow = document.createElement('div');
=======

      studentsList.innerHTML = '';
      let headerRow = document.createElement('div');
>>>>>>> 8a10078d72e928dabcb4a8a3d24d481b6c856ae0
>>>>>>> 085dd0e8e750431ab893f64fbb4cabf548d9e484
      headerRow.className = 'summary-row';
      headerRow.innerHTML = `<div>Day:</div>`;
      for (let i = 1; i <= days; i++) {
        let span = document.createElement('div');
        span.textContent = i;
        headerRow.appendChild(span);
      }
      studentsList.appendChild(headerRow);

      let daySummary = Array(days).fill(0);

      students.forEach(name => {
        let row = document.createElement('div');
        row.className = 'student-row';

        let label = document.createElement('div');
        label.textContent = name;
        row.appendChild(label);

        attendance[month][name].forEach((status, day) => {
          let cell = document.createElement('div');
          cell.className = `cell ${status === 'P' ? 'present' : status === 'Y' ? 'late' : 'absent'}`;
          cell.textContent = status;
          cell.onclick = () => {
            let nextStatus = status === 'A' ? 'P' : status === 'P' ? 'Y' : status === 'Y' ? 'A' : 'A';
            updateAttendance(name, day, nextStatus);
          };
          row.appendChild(cell);

          if (status === 'P') daySummary[day]++;
=======
        // Click to toggle attendance state
        box.addEventListener('click', () => {
          toggleAttendance(sIdx, d);
>>>>>>> 5b87cc91ca5adf13b9d4e80aa5def3f867e0d950
        });

        td.appendChild(box);
        tr.appendChild(td);
      }

      // Total present days cell
      const totalPresent = student.attendance.filter(a => a === 'present').length;
      const totalTd = document.createElement('td');
      totalTd.className = 'total-present-student';
      totalTd.textContent = totalPresent;
      tr.appendChild(totalTd);

      studentsBody.appendChild(tr);
    });

    renderSummary();
  }

  // Toggle attendance state for given student and day
  function toggleAttendance(studentIdx, dayIdx) {
    const curState = students[studentIdx].attendance[dayIdx];
    let nextIndex = attendanceStates.indexOf(curState) + 1;
    if(nextIndex >= attendanceStates.length) nextIndex = 0;
    students[studentIdx].attendance[dayIdx] = attendanceStates[nextIndex];
    renderStudents();
  }

  // Render summary (totals and percentages)
  function renderSummary() {
    const daysCount = monthNames[selectedMonthIndex].days;
    // Clear old totals and percentages cells except first and last
    while(summaryRow.children.length > 2) {
      summaryRow.removeChild(summaryRow.children[1]);
    }
    while(percentageRow.children.length > 2) {
      percentageRow.removeChild(percentageRow.children[1]);
>>>>>>> 308b4550136b5bb19543f670aacd10b93f823a14
    }

    function renderAttendanceForm() {
      const date = formatDate(document.getElementById('attendanceDate').value);
      if (!date) return alert("Select a valid date.");
      allDates.add(date);

      let html = `<h4>Mark Attendance for ${date}</h4><form>`;
      students.forEach((s, i) => {
        if (date >= s.joinDate) {
          const checked = s.attendance[date] === "Present" ? 'checked' : '';
          html += `<label><input type='checkbox' data-id='${i}' ${checked}/> ${s.name}</label><br/>`;
        }
      });
      html += `<button type='button' onclick='saveAttendance("${date}")'>Save</button></form>`;
      document.getElementById('attendanceForm').innerHTML = html;
    }

    function saveAttendance(date) {
      document.querySelectorAll('#attendanceForm input[type=checkbox]').forEach(cb => {
        const id = cb.getAttribute('data-id');
        students[id].attendance[date] = cb.checked ? "Present" : "Absent";
      });
      updateReport();
      alert("Attendance saved.");
    }

    function updateReport() {
      const tbody = document.getElementById('reportTable').querySelector('tbody');
      const monthInput = document.getElementById('reportMonth').value;
      tbody.innerHTML = '';

      students.forEach(s => {
        let present = 0, total = 0;
        let dayDetails = [];
        for (const [d, status] of Object.entries(s.attendance)) {
          if (d >= s.joinDate && (!monthInput || d.startsWith(monthInput))) {
            total++;
            if (status === "Present") {
              present++;
              dayDetails.push(`<span class='present-day'>${d} (P)</span>`);
            } else {
              dayDetails.push(`<span class='absent-day'>${d} (A)</span>`);
            }
          }
        }
        const absent = total - present;
        const percentage = total ? ((present / total) * 100).toFixed(2) : "0.00";
        tbody.innerHTML += `<tr>
          <td>${s.name}</td>
          <td>${s.joinDate}</td>
          <td>${present}</td>
          <td>${absent}</td>
          <td>${percentage}%</td>
          <td class="day-detail">${dayDetails.join(' ')}</td>
        </tr>`;
      });
    }
  </script>
</body>
</html>
