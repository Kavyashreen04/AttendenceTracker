<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student Attendance Tracker</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: #f5f7fa;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
  }
  #controls {
    text-align: center;
    margin-bottom: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  #month-container, #student-add-container {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  select, button, input[type="text"] {
    font-size: 16px;
    padding: 8px 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  select:hover, button:hover, input[type="text"]:focus {
    background-color: #e1e7f0;
  }
  input[type="text"] {
    width: 200px;
    cursor: text;
  }
  button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 3px 7px rgb(0 0 0 / 0.1);
  }
  thead {
    background-color: #34495e;
    color: white;
  }
  thead tr {
    text-align: center;
    font-weight: 700;
  }
  th, td {
    padding: 6px 4px;
    border: 1px solid #ddd;
    text-align: center;
    user-select: none;
  }
  tbody tr:nth-child(even) {
    background-color: #fafafa;
  }
  .attendance-box {
    width: 28px;
    height: 28px;
    line-height: 28px;
    border-radius: 5px;
    color: white;
    font-weight: 700;
    margin: 0 auto;
    cursor: pointer;
    user-select: none;
    font-family: monospace;
  }
  .present {
    background-color: #27ae60; /* green */
  }
  .absent {
    background-color: #c0392b; /* red */
  }
  .late {
    background-color: #f39c12; /* yellow/orange */
    color: #222;
  }
  #summary-row {
    font-weight: 700;
    background-color: #ecf0f1;
    color: #2c3e50;
  }
  #summary-row td {
    font-size: 14px;
    padding-top: 8px;
    padding-bottom: 8px;
  }
  #presentTotalContainer {
    text-align: right;
    margin-top: 8px;
    font-size: 16px;
    font-weight: 600;
    color: #34495e;
  }
  .total-present {
    background-color: #2980b9;
    padding: 8px 15px;
    border-radius: 12px;
    color: white;
    display: inline-block;
  }
  #table-container {
    max-width: 100%;
    overflow-x: auto;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
  }
  td.student-name {
    text-align: left;
    padding-left: 10px;
    font-weight: 600;
    background: #ecf0f1;
    min-width: 120px;
    position: sticky;
    left: 0;
    z-index: 2;
  }
  th.student-name-header {
    position: sticky;
    left: 0;
    background-color: #34495e;
    z-index: 3;
    min-width: 120px;
  }
  td.total-present-student {
    font-weight: 700;
    background-color: #ecf0f1;
    min-width: 110px;
    position: sticky;
    right: 0;
    z-index: 2;
  }
  th.total-present-header {
    position: sticky;
    right: 0;
    background-color: #34495e;
    z-index: 3;
    min-width: 110px;
  }
  @media (max-width: 720px) {
    body {
      margin: 15px 5px;
    }
    td.student-name, th.student-name-header,
    td.total-present-student, th.total-present-header {
      min-width: 85px;
      font-size: 12px;
      padding-left: 6px;
    }
    #controls {
      flex-direction: column;
      gap: 10px;
    }
    #student-add-container {
      width: 100%;
      justify-content: center;
    }
    input[type="text"] {
      width: 100%;
      max-width: 320px;
    }
  }
</style>
</head>
<body>

<h1>Student Attendance Tracker</h1>

<div id="controls">
  <div id="month-container">
    <label for="month-select">Select Month:</label>
    <select id="month-select" aria-label="Select Month"></select>
  </div>

  <div id="student-add-container">
    <input type="text" id="student-name-input" placeholder="Enter student name" aria-label="Student Name" />
    <button id="add-student-btn" disabled>Add Student</button>
  </div>
</div>

<div id="table-container">
  <table id="attendance-table" aria-label="Attendance Table">
    <thead>
      <tr id="table-header-row">
        <th class="student-name-header">Student Name</th>
        <!-- Dynamic day headers -->
        <th class="total-present-header">Present Days</th>
      </tr>
    </thead>
    <tbody id="students-body">
      <!-- Dynamic student rows -->
    </tbody>
    <tfoot>
      <tr id="summary-row">
        <td>Total Present</td>
        <!-- Day totals -->
        <td></td>
      </tr>
      <tr id="percentage-row">
        <td>Percentage (%)</td>
        <!-- Day percentages -->
        <td></td>
      </tr>
    </tfoot>
  </table>
</div>

<script>
  // Define months and their day counts (non-leap year for simplicity)
  const monthNames = [
    {name: "January", days: 31},
    {name: "February", days: 28},
    {name: "March", days: 31},
    {name: "April", days: 30},
    {name: "May", days: 31},
    {name: "June", days: 30},
    {name: "July", days: 31},
    {name: "August", days: 31},
    {name: "September", days: 30},
    {name: "October", days: 31},
    {name: "November", days: 30},
    {name: "December", days: 31},
  ];

  // Attendance states cycle: absent -> present -> late -> absent ...
  const attendanceStates = ['absent', 'present', 'late'];
  const attendanceLetters = {
    'absent': 'A',
    'present': 'P',
    'late': 'Y'
  };
  const attendanceColorsClass = {
    'absent': 'absent',
    'present': 'present',
    'late': 'late'
  };

  let students = [];

  let selectedMonthIndex = new Date().getMonth(); // current month default

  // Elements
  const monthSelect = document.getElementById('month-select');
  const addStudentBtn = document.getElementById('add-student-btn');
  const studentNameInput = document.getElementById('student-name-input');
  const attendanceTable = document.getElementById('attendance-table');
  const tableHeaderRow = document.getElementById('table-header-row');
  const studentsBody = document.getElementById('students-body');
  const summaryRow = document.getElementById('summary-row');
  const percentageRow = document.getElementById('percentage-row');

  // Initialize month dropdown
  function initMonthDropdown() {
    monthNames.forEach((m, idx) => {
      const option = document.createElement('option');
      option.value = idx;
      option.textContent = m.name;
      if(idx === selectedMonthIndex) option.selected = true;
      monthSelect.appendChild(option);
    });
  }

  // Generate table header for days in selected month
  function renderTableHeader() {
    // Remove old day headers & total-present header except first student name header
    while(tableHeaderRow.children.length > 2) {
      tableHeaderRow.removeChild(tableHeaderRow.children[1]);
    }

    const daysCount = monthNames[selectedMonthIndex].days;
    for(let d=1; d<=daysCount; d++) {
      const th = document.createElement('th');
      th.textContent = d;
      tableHeaderRow.insertBefore(th, tableHeaderRow.lastElementChild);
    }
  }

  // Add new student with default absent attendance for all days in selected month
  function addStudent(name) {
    if(!name || !name.trim()) return false;
    name = name.trim();

    // Prevent duplicate names
    if(students.some(s => s.name.toLowerCase() === name.toLowerCase())) {
      alert('Student with this name already exists.');
      return false;
    }

    const daysCount = monthNames[selectedMonthIndex].days;
    const attendance = Array(daysCount).fill('absent');
    students.push({name, attendance});
    renderStudents();
    return true;
  }

  // Render students rows
  function renderStudents() {
    studentsBody.innerHTML = '';
    const daysCount = monthNames[selectedMonthIndex].days;

    students.forEach((student, sIdx) => {
      const tr = document.createElement('tr');

      // Student name cell
      const nameTd = document.createElement('td');
      nameTd.textContent = student.name;
      nameTd.className = 'student-name';
      tr.appendChild(nameTd);

      // Attendance cells
      for(let d=0; d<daysCount; d++) {
        const td = document.createElement('td');

        const attendanceState = student.attendance[d];
        const box = document.createElement('div');
        box.className = 'attendance-box ' + attendanceColorsClass[attendanceState];
        box.textContent = attendanceLetters[attendanceState];
        box.title = `Day ${d+1}: ${attendanceState.charAt(0).toUpperCase() + attendanceState.slice(1)}`;

        // Click to toggle attendance state
        box.addEventListener('click', () => {
          toggleAttendance(sIdx, d);
        });

        td.appendChild(box);
        tr.appendChild(td);
      }

      // Total present days cell
      const totalPresent = student.attendance.filter(a => a === 'present').length;
      const totalTd = document.createElement('td');
      totalTd.className = 'total-present-student';
      totalTd.textContent = totalPresent;
      tr.appendChild(totalTd);

      studentsBody.appendChild(tr);
    });

    renderSummary();
  }

  // Toggle attendance state for given student and day
  function toggleAttendance(studentIdx, dayIdx) {
    const curState = students[studentIdx].attendance[dayIdx];
    let nextIndex = attendanceStates.indexOf(curState) + 1;
    if(nextIndex >= attendanceStates.length) nextIndex = 0;
    students[studentIdx].attendance[dayIdx] = attendanceStates[nextIndex];
    renderStudents();
  }

  // Render summary (totals and percentages)
  function renderSummary() {
    const daysCount = monthNames[selectedMonthIndex].days;
    // Clear old totals and percentages cells except first and last
    while(summaryRow.children.length > 2) {
      summaryRow.removeChild(summaryRow.children[1]);
    }
    while(percentageRow.children.length > 2) {
      percentageRow.removeChild(percentageRow.children[1]);
    }

    for(let d=0; d<daysCount; d++) {
      const totalPresent = students.reduce((acc, s) => acc + (s.attendance[d] === 'present' ? 1 : 0), 0);
      const totalTd = document.createElement('td');
      totalTd.textContent = totalPresent || 0;
      summaryRow.insertBefore(totalTd, summaryRow.lastElementChild);

      const perc = students.length > 0 ? ((totalPresent / students.length) * 100).toFixed(1) : '0.0';
      const percTd = document.createElement('td');
      percTd.textContent = perc;
      percentageRow.insertBefore(percTd, percentageRow.lastElementChild);
    }

    // Make sure last td of summary and percentage row is empty
    summaryRow.lastElementChild.textContent = '';
    percentageRow.lastElementChild.textContent = '';
  }

  // Reset data for new month selection, setting all students' attendance to absent for that month
  function resetDataForMonth(monthIndex) {
    selectedMonthIndex = monthIndex;
    const daysCount = monthNames[selectedMonthIndex].days;
    // Reset attendance arrays for all existing students to absent for new month days
    students.forEach(student => {
      student.attendance = Array(daysCount).fill('absent');
    });
    renderTableHeader();
    renderStudents();
  }

  // Enable or disable Add button depending on input
  function validateStudentInput() {
    const name = studentNameInput.value.trim();
    addStudentBtn.disabled = !name;
  }

  // Initialization on page load
  function init() {
    initMonthDropdown();
    renderTableHeader();

    // Add initial students with default absent attendance
    const initialStudentNames = ['Alice Johnson', 'Bob Smith', 'Charlie Lee', 'Diana Prince', 'Ethan Hunt'];
    const daysCount = monthNames[selectedMonthIndex].days;
    students = initialStudentNames.map(name => ({
      name,
      attendance: Array(daysCount).fill('absent')
    }));
    renderStudents();

    // Add event listener for month selection change
    monthSelect.addEventListener('change', (e) => {
      if(confirm('Changing the month will reset all attendance data. Proceed?')) {
        resetDataForMonth(parseInt(e.target.value));
        studentNameInput.value = '';
        validateStudentInput();
      } else {
        // revert selection to current month if cancel
        monthSelect.value = selectedMonthIndex;
      }
    });

    // Add event listeners on the student name input and button
    studentNameInput.addEventListener('input', validateStudentInput);

    addStudentBtn.addEventListener('click', () => {
      const name = studentNameInput.value.trim();
      if(name) {
        if(addStudent(name)) {
          studentNameInput.value = '';
          validateStudentInput();
          // Scroll to bottom to show newly added student
          studentsBody.lastElementChild?.scrollIntoView({behavior: 'smooth'});
        }
      }
    });

    validateStudentInput();
  }

  init();
</script>

</body>
</html>

